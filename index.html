<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>O IMPOSTOR ğŸ”ª</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background: #0f0f1a; color: #fff; font-family: 'Segoe UI', sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; }
        #game-container { background: #1c1c2d; width: 95%; max-width: 450px; padding: 25px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.7); border: 2px solid #3b3b55; position: relative; box-sizing: border-box; }
        .active { display: block !important; }
        .screen { display: none; }
        
        /* Painel Config */
        #settings-panel { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 85%; background: #2a2a40; padding: 20px; border-radius: 15px; border: 2px solid #e74c3c; z-index: 100; box-shadow: 0 0 50px #000; }
        .close-btn { float: right; cursor: pointer; font-size: 20px; color: #ff4757; }

        input, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: none; background: #2a2a40; color: #fff; font-size: 16px; box-sizing: border-box; }
        button { width: 100%; padding: 14px; border-radius: 10px; border: none; background: #7289da; color: white; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        #player-counter { background: #e74c3c; padding: 5px 15px; border-radius: 20px; font-size: 13px; margin-bottom: 10px; font-weight: bold; }
        #chat-box { height: 200px; overflow-y: auto; background: #0f0f1a; padding: 10px; border-radius: 10px; margin: 10px 0; border: 1px solid #3b3b55; }
        .msg { margin-bottom: 8px; border-bottom: 1px solid #222; padding-bottom: 4px; font-size: 14px; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .config-icon { position: absolute; top: 15px; right: 15px; font-size: 24px; cursor: pointer; z-index: 50; }
        .audio-status { font-size: 12px; color: #43b581; text-align: center; }
    </style>
</head>
<body>

    <div id="game-container">
        <div class="config-icon" onclick="toggleSettings()">âš™ï¸</div>

        <div id="settings-panel">
            <span class="close-btn" onclick="toggleSettings()">âœ–</span>
            <h2 style="margin: 0 0 15px 0; color: #e74c3c;">Painel</h2>
            
            <label>Seu PaÃ­s:</label>
            <select id="country-select">
                <option value="ğŸ‡§ğŸ‡·">Brasil ğŸ‡§ğŸ‡·</option>
                <option value="ğŸ‡ºğŸ‡¸">EUA ğŸ‡ºğŸ‡¸</option>
                <option value="ğŸ‡µğŸ‡¹">Portugal ğŸ‡µğŸ‡¹</option>
                <option value="ğŸ‡¦ğŸ‡·">Argentina ğŸ‡¦ğŸ‡·</option>
                <option value="ğŸ‡ªğŸ‡¸">Espanha ğŸ‡ªğŸ‡¸</option>
                <option value="ğŸ‡«ğŸ‡·">FranÃ§a ğŸ‡«ğŸ‡·</option>
                <option value="ğŸ‡®ğŸ‡¹">ItÃ¡lia ğŸ‡®ğŸ‡¹</option>
                <option value="ğŸ‡¯ğŸ‡µ">JapÃ£o ğŸ‡¯ğŸ‡µ</option>
            </select>

            <div style="background: #1c1c2d; padding: 10px; border-radius: 10px; margin-top: 10px;">
                <div style="display:flex; justify-content: space-between; align-items: center;">
                    <span>Ãudio do Jogo</span>
                    <button id="mute-btn" onclick="toggleMute()" style="width: auto; padding: 5px 15px; margin: 0; background: #43b581;">LIGADO ğŸ”Š</button>
                </div>
            </div>
            <button onclick="toggleSettings()" style="background: #e74c3c; margin-top: 20px;">FECHAR</button>
        </div>

        <div id="setup-screen" class="screen active">
            <h1 style="text-align: center; color: #e74c3c; margin-bottom: 20px;">O IMPOSTOR ğŸ”ª</h1>
            <input type="text" id="player-name" placeholder="Seu Nome..." maxlength="12">
            
            <div style="background: #2a2a40; padding: 10px; border-radius: 10px;">
                <label style="font-size: 11px; color: #888;">QUANTOS JOGADORES NA SALA?</label>
                <select id="max-players">
                    <option value="2">2 Jogadores (X1)</option>
                    <option value="3" selected>3 Jogadores</option>
                    <option value="4">4 Jogadores</option>
                    <option value="5">5 Jogadores</option>
                </select>
            </div>

            <button onclick="setupHost()" style="background:#43b581">CRIAR SALA</button>
            <div style="text-align: center; margin: 10px 0; color: #888;">--- OU ---</div>
            <input type="text" id="join-id" placeholder="ID da Sala">
            <button onclick="joinRoom()">ENTRAR</button>
        </div>

        <div id="game-screen" class="screen">
            <center><div id="player-counter">Players: 1/--</div></center>
            <div id="status-msg" style="text-align: center; font-weight: bold; color: #f1c40f;">Aguardando...</div>
            <div id="role-display" style="padding: 10px; text-align: center; border-radius: 10px; margin: 10px 0; font-weight: bold;">-</div>
            
            <div id="chat-box"></div>
            
            <div style="display:flex; gap:5px">
                <input type="text" id="chat-input" placeholder="Digite uma pista...">
                <button onclick="sendMsg()" style="width:70px; margin:8px 0; background:#f39c12">OK</button>
            </div>

            <button id="btn-guess" style="display:none; background:#e74c3c" onclick="impostorGuess()">ADIVINHAR ğŸ’¡</button>
            <button id="btn-vote" style="background:#f1c40f; color:#000" onclick="openVote()">VOTAR âš–ï¸</button>
        </div>
    </div>

<script>
    let peer = new Peer(), conn, myId, isHost = false, amIImpostor = false;
    let players = [], maxPlayers = 3, turnIndex = 0;
    let words = ["TABLET", "FOGO", "PIZZA", "CELULAR", "GELADEIRA", "CAFÃ‰", "BOLO", "XBOX", "CARRO"];
    let currentWord = "", myStream, isMuted = false;

    peer.on('open', id => myId = id);

    function toggleSettings() {
        const p = document.getElementById('settings-panel');
        p.style.display = p.style.display === 'block' ? 'none' : 'block';
    }

    function toggleMute() {
        isMuted = !isMuted;
        const btn = document.getElementById('mute-btn');
        btn.innerText = isMuted ? "MUTADO ğŸ”‡" : "LIGADO ğŸ”Š";
        btn.style.background = isMuted ? "#ff4757" : "#43b581";
        if(myStream) myStream.getAudioTracks().forEach(t => t.enabled = !isMuted);
    }

    async function initAudio() {
        try {
            myStream = await navigator.mediaDevices.getUserMedia({ audio: true });
            peer.on('call', call => {
                call.answer(myStream);
                call.on('stream', remoteStream => {
                    const audio = new Audio(); audio.srcObject = remoteStream;
                    audio.play();
                });
            });
        } catch (e) { console.warn("Sem Ã¡udio."); }
    }

    async function setupHost() {
        await initAudio();
        isHost = true;
        maxPlayers = parseInt(document.getElementById('max-players').value);
        showScreen('game-screen');
        updateCounter();

        peer.on('connection', c => {
            c.on('data', data => {
                if(data.type === 'auth') {
                    players.push({id: c.peer, name: data.name, country: data.country, conn: c});
                    c.send({type: 'auth_ok', max: maxPlayers});
                    peer.call(c.peer, myStream);
                    updateCounter();
                    players.forEach(p => p.conn.send({type: 'counter', val: players.length+1}));
                    if(players.length === maxPlayers - 1) startGame();
                }
                if(data.type === 'chat') handleChat(data);
                if(data.type === 'guess') checkGuess(data.word, data.name);
            });
        });
        alert("ID DA SALA: " + myId + "\nMande para seus amigos!");
    }

    async function joinRoom() {
        await initAudio();
        const hostId = document.getElementById('join-id').value;
        const name = document.getElementById('player-name').value || "Player";
        const country = document.getElementById('country-select').value;
        
        conn = peer.connect(hostId);
        conn.on('open', () => conn.send({type: 'auth', name: name, country: country}));
        conn.on('data', data => {
            if(data.type === 'auth_ok') { maxPlayers = data.max; showScreen('game-screen'); }
            if(data.type === 'counter') updateCounter(data.val);
            if(data.type === 'start') handleStart(data);
            if(data.type === 'chat') addMsg(data.name, data.text, data.country);
            if(data.type === 'end') { alert(data.msg); location.reload(); }
        });
    }

    function updateCounter(val) {
        const count = val || (players.length + 1);
        document.getElementById('player-counter').innerText = `Players: ${count}/${maxPlayers}`;
    }

    function startGame() {
        currentWord = words[Math.floor(Math.random()*words.length)];
        const impIdx = Math.floor(Math.random() * maxPlayers);
        const myName = document.getElementById('player-name').value;
        const myCountry = document.getElementById('country-select').value;
        
        const all = [{name: myName, country: myCountry, isImp: (impIdx===0)}, 
                     ...players.map((p, i) => ({name: p.name, country: p.country, isImp: (impIdx===i+1)}))];

        players.forEach((p, i) => p.conn.send({type: 'start', isImp: (impIdx === i+1), word: currentWord}));
        handleStart({isImp: (impIdx === 0), word: currentWord});
    }

    function handleStart(data) {
        amIImpostor = data.isImp; currentWord = data.word;
        const d = document.getElementById('role-display');
        d.innerText = amIImpostor ? "VOCÃŠ Ã‰ O IMPOSTOR!" : "PALAVRA: " + currentWord;
        d.style.background = amIImpostor ? "#e74c3c" : "#27ae60";
        document.getElementById('btn-guess').style.display = amIImpostor ? "block" : "none";
        document.getElementById('status-msg').innerText = "JOGO INICIADO!";
    }

    function sendMsg() {
        const i = document.getElementById('chat-input'); if(!i.value) return;
        const n = document.getElementById('player-name').value;
        const c = document.getElementById('country-select').value;
        if(isHost) handleChat({name:n, text:i.value, country:c}); else conn.send({type: 'chat', name:n, text:i.value, country:c});
        i.value = "";
    }

    function handleChat(data) {
        addMsg(data.name, data.text, data.country);
        if(isHost) players.forEach(p => p.conn.send({type: 'chat', ...data}));
    }

    function addMsg(n, t, c) {
        const b = document.getElementById('chat-box');
        b.innerHTML += `<div class="msg"><span>${c}</span> <b>${n}:</b> ${t}</div>`;
        b.scrollTop = b.scrollHeight;
    }

    function showScreen(s) { document.querySelectorAll('.screen').forEach(d => d.classList.remove('active')); document.getElementById(s).classList.add('active'); }

    function checkGuess(g, name) {
        const win = g.toUpperCase().includes(currentWord);
        const msg = win ? `O IMPOSTOR GANHOU! A palavra era ${currentWord}` : `IMPOSTOR ERROU! Era ${currentWord}. Inocentes ganharam!`;
        if(isHost) players.forEach(p => p.conn.send({type: 'end', msg}));
        alert(msg); location.reload();
    }

    function impostorGuess() {
        const g = prompt("Qual Ã© a palavra secreta?");
        if(g) { if(isHost) checkGuess(g, "Host"); else conn.send({type: 'guess', word: g, name: document.getElementById('player-name').value}); }
    }

    function openVote() {
        const t = prompt("Nome de quem vocÃª quer expulsar:");
        if(t) alert("Voto registrado em " + t + "! (Aguardando outros jogadores)");
    }
</script>
</body>
</html>
