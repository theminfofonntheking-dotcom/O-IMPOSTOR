<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O IMPOSTOR üî™</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --primary: #e74c3c; --bg: #0f0f1a; --card: #1c1c2d; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        
        #game-container { background: var(--card); width: 95%; max-width: 500px; padding: 30px; border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.8); border: 3px solid #3b3b55; position: relative; box-sizing: border-box; }
        
        /* √çcone de Configura√ß√£o reposicionado no topo */
        .config-icon { position: absolute; top: -50px; right: 5px; font-size: 32px; cursor: pointer; background: var(--card); padding: 8px; border-radius: 50%; border: 2px solid #3b3b55; }

        .screen { display: none; flex-direction: column; gap: 15px; }
        .active { display: flex !important; }

        input, select { width: 100%; padding: 18px; border-radius: 15px; border: none; background: #2a2a40; color: #fff; font-size: 18px; box-sizing: border-box; outline: none; }
        button { width: 100%; padding: 20px; border-radius: 15px; border: none; background: #7289da; color: white; font-weight: bold; font-size: 18px; cursor: pointer; }

        #top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; width: 100%; }
        #player-counter { background: var(--primary); padding: 8px 15px; border-radius: 20px; font-weight: bold; font-size: 16px; }
        
        #role-display { padding: 20px; text-align: center; border-radius: 20px; font-size: 22px; font-weight: bold; margin: 10px 0; }
        
        #chat-box { height: 280px; overflow-y: auto; background: #0a0a14; padding: 15px; border-radius: 20px; border: 2px solid #3b3b55; margin-bottom: 10px; }
        .msg { padding: 5px; font-size: 16px; border-bottom: 1px solid #1c1c2d; margin-bottom: 5px; }

        #ptt-btn { background: #444; height: 70px; font-size: 18px; margin: 10px 0; }
        #ptt-btn.mic-on { background: #27ae60; box-shadow: 0 0 15px #27ae60; }

        #settings-panel { display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; background: #2a2a40; padding: 25px; border-radius: 25px; border: 3px solid var(--primary); z-index: 100; box-shadow: 0 0 100px #000; }
    </style>
</head>
<body>

    <div id="game-container">
        <div class="config-icon" onclick="toggleSettings()">‚öôÔ∏è</div>

        <div id="settings-panel">
            <h2 id="txt-config">Configura√ß√µes</h2>
            <label id="txt-lang">Idioma / Language:</label>
            <select id="country-select" onchange="updateLanguage()">
                <option value="üáßüá∑">Brasil üáßüá∑</option>
                <option value="üáµüáπ">Portugal üáµüáπ</option>
                <option value="üá∫üá∏">USA üá∫üá∏</option>
                <option value="üáØüáµ">Japan üáØüáµ</option>
            </select>
            <button onclick="toggleSettings()" style="background: #27ae60; margin-top: 20px;">OK</button>
        </div>

        <div id="setup-screen" class="screen active">
            <h1 style="text-align: center; color: var(--primary); margin: 0;">O IMPOSTOR üî™</h1>
            <input type="text" id="player-name" placeholder="Nome / Name" maxlength="15">
            <select id="max-players">
                <option value="2">2 PLAYERS</option>
                <option value="3" selected>3 PLAYERS</option>
                <option value="4">4 PLAYERS</option>
                <option value="5">5 PLAYERS</option>
            </select>
            <input type="password" id="room-pass" placeholder="Senha da Sala">
            <button onclick="setupHost()" style="background:#27ae60" id="btn-create">CRIAR SALA</button>
            <hr style="border: 1px solid #3b3b55; width: 100%;">
            <input type="text" id="join-id" placeholder="ID da Sala">
            <input type="password" id="join-pass-input" placeholder="Senha">
            <button onclick="joinRoom()" id="btn-join">ENTRAR</button>
        </div>

        <div id="game-screen" class="screen">
            <div id="top-bar">
                <div id="player-counter">1/--</div>
                <button onclick="copyLink()" style="width: auto; padding: 10px; font-size: 14px; margin:0">üìã LINK</button>
            </div>
            
            <div id="role-display" style="background: #34495e;">---</div>
            
            <div id="chat-box"></div>
            
            <div style="display:flex; gap:10px">
                <input type="text" id="chat-input" placeholder="...">
                <button onclick="sendMsg()" style="width:100px; margin:0; background:#f39c12">OK</button>
            </div>

            <button id="ptt-btn">SEGURE PARA FALAR üéôÔ∏è</button>
            
            <div style="display:flex; gap:10px">
                <button id="btn-guess-ui" style="display:none; background:#e74c3c" onclick="impostorGuess()">ADIVINHAR</button>
                <button id="btn-vote-ui" style="background:#f1c40f; color:#000" onclick="openVote()">VOTAR</button>
            </div>
        </div>
    </div>

<script>
    let peer = new Peer(), conn, myId, isHost = false;
    let players = [], maxPlayers = 3, currentWord = "", myStream;
    let words = ["TELEVIS√ÉO", "COMPUTADOR", "CELULAR", "GELADEIRA", "CARRO", "PIZZA", "BOLO", "FOGO", "SAPATO", "AVIAO", "CACHORRO"];

    const translations = {
        "üáßüá∑": { create: "CRIAR SALA", join: "ENTRAR", talk: "SEGURE PARA FALAR üéôÔ∏è", vote: "VOTAR", guess: "ADIVINHAR", imp: "VOC√ä √â O IMPOSTOR! üî™", word: "PALAVRA: ", config: "Configura√ß√µes", lang: "Idioma:" },
        "üáµüáπ": { create: "CRIAR SALA", join: "ENTRAR", talk: "SEGURA PARA FALAR üéôÔ∏è", vote: "VOTAR", guess: "ADIVINHAR", imp: "√âS O IMPOSTOR! üî™", word: "PALAVRA: ", config: "Defini√ß√µes", lang: "L√≠ngua:" },
        "üá∫üá∏": { create: "CREATE ROOM", join: "JOIN", talk: "HOLD TO TALK üéôÔ∏è", vote: "VOTE", guess: "GUESS", imp: "YOU ARE THE IMPOSTOR! üî™", word: "WORD: ", config: "Settings", lang: "Language:" },
        "üáØüáµ": { create: "ÈÉ®Â±ã„Çí‰Ωú„Çã", join: "ÂÖ•„Çã", talk: "Èï∑Êäº„Åó„ÅßË©±„Åô üéôÔ∏è", vote: "ÊäïÁ•®", guess: "ÂΩì„Å¶„Çã", imp: "„ÅÇ„Å™„Åü„ÅØ„Ç§„É≥„Éù„Çπ„Çø„Éº„Åß„ÅôÔºÅ üî™", word: "ÂçòË™û: ", config: "Ë®≠ÂÆö", lang: "Ë®ÄË™û:" }
    };

    function updateLanguage() {
        const flag = document.getElementById('country-select').value;
        const l = translations[flag] || translations["üáßüá∑"];
        document.getElementById('btn-create').innerText = l.create;
        document.getElementById('btn-join').innerText = l.join;
        document.getElementById('ptt-btn').innerText = l.talk;
        document.getElementById('btn-vote-ui').innerText = l.vote;
        document.getElementById('btn-guess-ui').innerText = l.guess;
        document.getElementById('txt-config').innerText = l.config;
        document.getElementById('txt-lang').innerText = l.lang;
    }

    async function initMic() {
        try {
            myStream = await navigator.mediaDevices.getUserMedia({ audio: true });
            myStream.getAudioTracks()[0].enabled = false;
            peer.on('call', call => {
                call.answer(myStream);
                call.on('stream', s => { const a = new Audio(); a.srcObject = s; a.play(); });
            });
            const btn = document.getElementById('ptt-btn');
            const start = () => { if(myStream){ myStream.getAudioTracks()[0].enabled = true; btn.classList.add('mic-on'); }};
            const stop = () => { if(myStream){ myStream.getAudioTracks()[0].enabled = false; btn.classList.remove('mic-on'); }};
            btn.onmousedown = start; btn.onmouseup = stop;
            btn.ontouchstart = (e) => { e.preventDefault(); start(); }; btn.ontouchend = stop;
        } catch(e) { alert("Microfone necess√°rio!"); }
    }

    async function setupHost() {
        const pass = document.getElementById('room-pass').value;
        if(!pass) return alert("Defina uma senha!");
        await initMic();
        isHost = true;
        maxPlayers = parseInt(document.getElementById('max-players').value);
        showScreen('game-screen');
        updateCounter();

        peer.on('connection', c => {
            c.on('data', data => {
                if(data.type === 'auth') {
                    if(data.pass === pass) {
                        players.push({id: c.peer, name: data.name, country: data.country, conn: c});
                        c.send({type: 'auth_ok', max: maxPlayers});
                        peer.call(c.peer, myStream);
                        updateCounter();
                        players.forEach(p => p.conn.send({type:'counter', val: players.length+1}));
                        if(players.length === maxPlayers - 1) startGame();
                    } else c.send({type: 'auth_fail'});
                }
                if(data.type === 'chat') handleChat(data);
                if(data.type === 'guess') checkGuess(data.word, data.name);
            });
        });
        alert("ID: " + myId);
    }

    async function joinRoom() {
        await initMic();
        const id = document.getElementById('join-id').value;
        const pass = document.getElementById('join-pass-input').value;
        conn = peer.connect(id);
        conn.on('open', () => {
            conn.send({type:'auth', pass, name: document.getElementById('player-name').value, country: document.getElementById('country-select').value});
        });
        conn.on('data', data => {
            if(data.type === 'auth_ok') { maxPlayers = data.max; showScreen('game-screen'); }
            if(data.type === 'auth_fail') alert("Senha Errada!");
            if(data.type === 'counter') updateCounter(data.val);
            if(data.type === 'start') handleStart(data);
            if(data.type === 'chat') addMsg(data.name, data.text, data.country);
            if(data.type === 'end') { alert(data.msg); location.reload(); }
        });
    }

    function startGame() {
        currentWord = words[Math.floor(Math.random()*words.length)];
        const impIdx = Math.floor(Math.random() * maxPlayers);
        players.forEach((p, i) => p.conn.send({type: 'start', isImp: (impIdx === i+1), word: currentWord}));
        handleStart({isImp: (impIdx === 0), word: currentWord});
    }

    function handleStart(data) {
        const flag = document.getElementById('country-select').value;
        const l = translations[flag] || translations["üáßüá∑"];
        const d = document.getElementById('role-display');
        currentWord = data.word;
        if(data.isImp) {
            d.innerText = l.imp; d.style.background = "#e74c3c";
            document.getElementById('btn-guess-ui').style.display = 'block';
        } else {
            d.innerText = l.word + data.word; d.style.background = "#27ae60";
        }
    }

    function sendMsg() {
        const input = document.getElementById('chat-input');
        if(!input.value.trim()) return;
        const data = {name: document.getElementById('player-name').value || "Player", text: input.value, country: document.getElementById('country-select').value};
        if(isHost) handleChat(data); else conn.send({type:'chat', ...data});
        input.value = ""; 
    }

    function handleChat(data) {
        addMsg(data.name, data.text, data.country);
        if(isHost) players.forEach(p => p.conn.send({type:'chat', ...data}));
    }

    function addMsg(n, t, c) {
        const b = document.getElementById('chat-box');
        b.innerHTML += `<div class="msg"><span>${c}</span> <b>${n}:</b> ${t}</div>`;
        b.scrollTop = b.scrollHeight;
    }

    function updateCounter(v) { document.getElementById('player-counter').innerText = `${v || (players.length+1)}/${maxPlayers}`; }
    function showScreen(s) { document.querySelectorAll('.screen').forEach(d => d.classList.remove('active')); document.getElementById(s).classList.add('active'); }
    function toggleSettings() { const s = document.getElementById('settings-panel'); s.style.display = (s.style.display==='block'?'none':'block'); }
    function copyLink() { navigator.clipboard.writeText(myId); alert("ID Copiado!"); }

    function checkGuess(g, name) {
        const win = g.toUpperCase().includes(currentWord);
        const msg = win ? `IMPOSTOR GANHOU! Era ${currentWord}` : `IMPOSTOR ERROU! Era ${currentWord}`;
        if(isHost) players.forEach(p => p.conn.send({type:'end', msg}));
        alert(msg); location.reload();
    }
    function impostorGuess() { const g = prompt("Palavra?"); if(g) { if(isHost) checkGuess(g, "Host"); else conn.send({type:'guess', word:g, name: document.getElementById('player-name').value}); }}
    function openVote() { alert("Votado!"); }
</script>
</body>
</html>
